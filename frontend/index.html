<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>RouteSafe Navigator Â· v1.1</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Leaflet CSS -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
    crossorigin=""
  />

  <style>
    :root {
      --rs-bg: #02061a;
      --rs-bg-soft: #050b24;
      --rs-card: #060d2f;
      --rs-card-soft: #081238;
      --rs-primary: #002c77;
      --rs-primary-soft: #234a9b;
      --rs-accent: #25b45b;
      --rs-text-main: #ffffff;
      --rs-text-soft: #c5d0ff;
      --rs-border-soft: rgba(255, 255, 255, 0.08);
      --rs-shadow-soft: 0 18px 45px rgba(0, 0, 0, 0.7);
      --radius-xl: 24px;
      --radius-lg: 18px;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      min-height: 100vh;
      background: radial-gradient(circle at top, #071436 0, #02061a 45%, #000 100%);
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      color: var(--rs-text-main);
      display: flex;
      justify-content: center;
    }

    .app-shell {
      width: 100%;
      max-width: 960px;
      padding: 1.25rem 0.75rem 2.5rem;
    }

    @media (min-width: 768px) {
      .app-shell {
        padding: 2rem 1.5rem 3rem;
      }
    }

    .hero-header {
      display: flex;
      align-items: center;
      gap: 1rem;
      margin-bottom: 1.75rem;
    }

    .app-icon {
      width: 52px;
      height: 52px;
      border-radius: 18px;
      background: radial-gradient(circle at 20% 0, #3d7cff, #002c77 55%, #000 100%);
      border: 1px solid rgba(255, 255, 255, 0.12);
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 12px 25px rgba(0, 0, 0, 0.6);
      overflow: hidden;
      flex-shrink: 0;
    }

    .app-icon span {
      font-weight: 700;
      font-size: 0.7rem;
      letter-spacing: 0.04em;
      text-transform: uppercase;
      text-align: center;
      line-height: 1.1;
    }

    .hero-text {
      flex: 1;
      min-width: 0;
    }

    .hero-title {
      font-size: 1.5rem;
      font-weight: 700;
      letter-spacing: 0.02em;
      margin-bottom: 0.1rem;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .hero-subtitle {
      font-size: 0.85rem;
      color: var(--rs-text-soft);
    }

    .hero-badges {
      display: flex;
      flex-wrap: wrap;
      gap: 0.4rem;
      margin-top: 0.35rem;
    }

    .pill {
      border-radius: 999px;
      padding: 0.2rem 0.6rem;
      font-size: 0.75rem;
      border: 1px solid rgba(255, 255, 255, 0.14);
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.04), rgba(0, 0, 0, 0.35));
      display: inline-flex;
      align-items: center;
      gap: 0.3rem;
      color: var(--rs-text-soft);
    }

    .pill.primary {
      border-color: rgba(37, 180, 91, 0.6);
      background: radial-gradient(circle at 0 0, rgba(88, 255, 161, 0.35), rgba(10, 41, 23, 0.9));
      color: #e8ffef;
    }

    .pill strong {
      font-weight: 600;
    }

    .byline-pill {
      font-size: 0.7rem;
      opacity: 0.9;
    }

    /* Main layout */
    .grid {
      display: grid;
      grid-template-columns: minmax(0, 1.1fr);
      gap: 1.25rem;
    }

    @media (min-width: 900px) {
      .grid {
        grid-template-columns: minmax(0, 0.9fr) minmax(0, 1.1fr);
      }
    }

    .card {
      border-radius: var(--radius-xl);
      background: radial-gradient(circle at top left, rgba(45, 103, 255, 0.28), transparent 55%),
        linear-gradient(145deg, var(--rs-card) 0%, var(--rs-card-soft) 60%, #020619 100%);
      border: 1px solid var(--rs-border-soft);
      box-shadow: var(--rs-shadow-soft);
      padding: 1.25rem 1.1rem 1.35rem;
      position: relative;
      overflow: hidden;
    }

    @media (min-width: 768px) {
      .card {
        padding: 1.5rem 1.4rem 1.5rem;
      }
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      gap: 0.75rem;
      margin-bottom: 1rem;
    }

    .card-title {
      font-size: 1.1rem;
      font-weight: 600;
      letter-spacing: 0.02em;
    }

    .card-subtitle {
      font-size: 0.8rem;
      color: var(--rs-text-soft);
      margin-top: 0.25rem;
    }

    /* Form */
    .form-grid {
      display: grid;
      gap: 0.8rem;
      margin-top: 0.2rem;
    }

    .field-label {
      font-size: 0.8rem;
      color: var(--rs-text-soft);
      margin-bottom: 0.25rem;
    }

    .field-label span {
      color: #ffb347;
      margin-left: 0.15rem;
    }

    .input,
    .toggle-row {
      border-radius: 999px;
      border: 1px solid rgba(255, 255, 255, 0.12);
      background: rgba(3, 6, 28, 0.7);
      padding: 0.55rem 0.9rem;
      font-size: 0.9rem;
      color: var(--rs-text-main);
      width: 100%;
      outline: none;
      transition: border-color 0.18s ease, box-shadow 0.18s ease, background 0.18s ease;
    }

    .input::placeholder {
      color: rgba(197, 208, 255, 0.5);
    }

    .input:focus {
      border-color: rgba(91, 163, 255, 0.85);
      box-shadow: 0 0 0 1px rgba(69, 148, 255, 0.45);
      background: rgba(5, 11, 45, 0.95);
    }

    .toggle-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 0.75rem;
    }

    .toggle-label-text {
      font-size: 0.85rem;
      color: var(--rs-text-soft);
    }

    .toggle {
      position: relative;
      width: 46px;
      height: 24px;
      border-radius: 999px;
      background: linear-gradient(135deg, #18203b, #020515);
      border: 1px solid rgba(255, 255, 255, 0.18);
      cursor: pointer;
      flex-shrink: 0;
    }

    .toggle input {
      position: absolute;
      inset: 0;
      opacity: 0;
      cursor: pointer;
    }

    .toggle-knob {
      position: absolute;
      top: 2px;
      left: 2px;
      width: 18px;
      height: 18px;
      border-radius: 50%;
      background: radial-gradient(circle at 30% 0, #ffffff, #c8d5ff);
      box-shadow: 0 0 14px rgba(255, 255, 255, 0.5);
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

    .toggle input:checked + .toggle-knob {
      transform: translateX(20px);
      box-shadow: 0 0 16px rgba(55, 243, 120, 0.9);
    }

    .toggle::before {
      content: "";
      position: absolute;
      inset: -6px;
      border-radius: inherit;
      background: radial-gradient(circle at 10% 0, rgba(93, 255, 164, 0.45), transparent 60%);
      opacity: 0;
      transition: opacity 0.2s ease;
      pointer-events: none;
    }

    .toggle input:checked ~ .toggle::before {
      opacity: 1;
    }

    .btn-primary {
      margin-top: 0.4rem;
      border-radius: 999px;
      border: 1px solid rgba(76, 170, 255, 0.8);
      padding: 0.8rem 1.1rem;
      font-size: 0.95rem;
      font-weight: 600;
      letter-spacing: 0.02em;
      text-align: center;
      cursor: pointer;
      width: 100%;
      background: radial-gradient(circle at 0 0, rgba(0, 255, 163, 0.25), transparent 55%),
        linear-gradient(135deg, #003a9a, #00163f);
      color: #f5fbff;
      box-shadow: 0 0 18px rgba(70, 219, 137, 0.4);
      transition: transform 0.1s ease, box-shadow 0.1s ease, filter 0.1s ease;
    }

    .btn-primary:hover {
      filter: brightness(1.06);
      box-shadow: 0 0 26px rgba(70, 219, 137, 0.7);
      transform: translateY(-1px);
    }

    .btn-primary:active {
      transform: translateY(1px) scale(0.99);
      box-shadow: 0 0 14px rgba(70, 219, 137, 0.5);
    }

    .btn-primary[disabled] {
      opacity: 0.65;
      cursor: wait;
      box-shadow: none;
    }

    .helper-text {
      margin-top: 0.45rem;
      font-size: 0.78rem;
      color: var(--rs-text-soft);
      opacity: 0.85;
    }

    /* Summary card */
    .summary-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 0.75rem;
      margin-top: 0.9rem;
    }

    .summary-item-label {
      font-size: 0.76rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: rgba(197, 208, 255, 0.7);
      margin-bottom: 0.18rem;
    }

    .summary-item-value {
      font-size: 0.98rem;
      font-weight: 600;
    }

    .badge-risk {
      border-radius: 999px;
      padding: 0.18rem 0.55rem;
      font-size: 0.8rem;
      display: inline-flex;
      align-items: center;
      gap: 0.35rem;
      border: 1px solid rgba(255, 255, 255, 0.14);
      background: radial-gradient(circle at 0 0, rgba(0, 0, 0, 0.45), rgba(255, 255, 255, 0.04));
    }

    .badge-risk-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
    }

    .badge-risk.low .badge-risk-dot {
      background: #25b45b;
      box-shadow: 0 0 10px rgba(37, 180, 91, 0.9);
    }

    .badge-risk.medium .badge-risk-dot {
      background: #ffb347;
      box-shadow: 0 0 10px rgba(255, 179, 71, 0.9);
    }

    .badge-risk.high .badge-risk-dot {
      background: #ff4d4d;
      box-shadow: 0 0 10px rgba(255, 77, 77, 0.9);
    }

    /* Map */
    #map {
      width: 100%;
      height: 320px;
      border-radius: var(--radius-lg);
      overflow: hidden;
      border: 1px solid rgba(255, 255, 255, 0.16);
      margin-top: 0.9rem;
    }

    @media (min-width: 900px) {
      #map {
        height: 420px;
      }
    }

    .map-caption {
      margin-top: 0.5rem;
      font-size: 0.78rem;
      color: var(--rs-text-soft);
      display: flex;
      justify-content: space-between;
      gap: 0.75rem;
      align-items: baseline;
    }

    /* Messages */
    .message {
      margin-top: 0.7rem;
      border-radius: 14px;
      padding: 0.55rem 0.7rem;
      font-size: 0.8rem;
      display: none;
      align-items: center;
      gap: 0.5rem;
    }

    .message.visible {
      display: flex;
    }

    .message.error {
      background: rgba(255, 77, 77, 0.12);
      border: 1px solid rgba(255, 77, 77, 0.6);
      color: #ffd7d7;
    }

    .message.info {
      background: rgba(69, 148, 255, 0.14);
      border: 1px solid rgba(69, 148, 255, 0.7);
      color: #e0ecff;
    }

    .message span.icon {
      font-size: 1rem;
    }

    footer {
      margin-top: 1.8rem;
      font-size: 0.76rem;
      color: rgba(197, 208, 255, 0.7);
      text-align: center;
    }
  </style>
</head>
<body>
  <div class="app-shell">
    <header class="hero-header">
      <div class="app-icon">
        <span>Route<br />Safe</span>
      </div>
      <div class="hero-text">
        <div class="hero-title">RouteSafe Navigator</div>
        <div class="hero-subtitle">Intelligent low-bridge avoidance for HGVs</div>
        <div class="hero-badges">
          <div class="pill primary"><strong>v1.1</strong></div>
          <div class="pill byline-pill">by RouteSafe AI</div>
        </div>
      </div>
    </header>

    <main class="grid">
      <!-- Left / top: form -->
      <section class="card">
        <div class="card-header">
          <div>
            <div class="card-title">Plan a Safe Route</div>
            <div class="card-subtitle">
              Enter UK postcodes and your vehicle height. Weâ€™ll check the route against low bridges.
            </div>
          </div>
        </div>

        <form id="route-form">
          <div class="form-grid">
            <div>
              <div class="field-label">Start postcode<span>*</span></div>
              <input
                id="start"
                class="input"
                autocomplete="postal-code"
                placeholder="e.g. LS27 0BN"
              />
            </div>

            <div>
              <div class="field-label">Destination postcode<span>*</span></div>
              <input
                id="destination"
                class="input"
                autocomplete="postal-code"
                placeholder="e.g. M31 4QN"
              />
            </div>

            <div>
              <div class="field-label">Vehicle height (m)<span>*</span></div>
              <input
                id="height"
                class="input"
                type="number"
                step="0.1"
                min="2"
                max="6.5"
                placeholder="e.g. 4.6"
              />
            </div>

            <div>
              <label class="toggle-row">
                <div class="toggle-label-text">Avoid low bridges</div>
                <label class="toggle">
                  <input id="avoid" type="checkbox" checked />
                  <span class="toggle-knob"></span>
                </label>
              </label>
            </div>
          </div>

          <button id="submit-btn" class="btn-primary" type="submit">
            Generate Safe Route
          </button>

          <div class="helper-text">
            Uses RouteSafe engine Â· ORS routing Â· UK bridge data.
          </div>

          <div id="message" class="message">
            <span class="icon">â“˜</span>
            <span id="message-text"></span>
          </div>
        </form>
      </section>

      <!-- Right / bottom: summary + map -->
      <section class="card">
        <div class="card-header">
          <div>
            <div class="card-title">Route summary</div>
            <div class="card-subtitle">
              Distance, ETA, and nearest low bridge along your selected route.
            </div>
          </div>
          <div id="risk-chip" class="pill primary">
            <span class="badge-risk-dot"></span>
            <span id="risk-label">Low risk</span>
          </div>
        </div>

        <div class="summary-grid">
          <div>
            <div class="summary-item-label">Distance</div>
            <div id="summary-distance" class="summary-item-value">â€“</div>
          </div>
          <div>
            <div class="summary-item-label">Estimated time</div>
            <div id="summary-time" class="summary-item-value">â€“</div>
          </div>
          <div>
            <div class="summary-item-label">Bridge risk</div>
            <div id="summary-bridge-risk" class="summary-item-value">
              No low-bridge conflicts detected
            </div>
          </div>
          <div>
            <div class="summary-item-label">Nearest low bridge</div>
            <div id="summary-nearest" class="summary-item-value">None on route</div>
          </div>
        </div>

        <div class="map-caption">
          <span>Map view</span>
          <span>RouteSafe engine Â· ORS + UK bridge data</span>
        </div>
        <div id="map"></div>
      </section>
    </main>

    <footer>RouteSafe Navigator Â· Prototype preview for evaluation only.</footer>
  </div>

  <!-- Leaflet JS -->
  <script
    src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
    crossorigin=""
  ></script>

  <script>
    // ðŸ”§ CHANGE THIS LINE ONLY if your backend URL is different
    const API_URL = "https://routesafe-ai.onrender.com/api/route";

    const form = document.getElementById("route-form");
    const startInput = document.getElementById("start");
    const destInput = document.getElementById("destination");
    const heightInput = document.getElementById("height");
    const avoidInput = document.getElementById("avoid");
    const submitBtn = document.getElementById("submit-btn");

    const messageBox = document.getElementById("message");
    const messageText = document.getElementById("message-text");

    const summaryDistance = document.getElementById("summary-distance");
    const summaryTime = document.getElementById("summary-time");
    const summaryBridgeRisk = document.getElementById("summary-bridge-risk");
    const summaryNearest = document.getElementById("summary-nearest");
    const riskChip = document.getElementById("risk-chip");
    const riskLabel = document.getElementById("risk-label");

    // Leaflet map
    const map = L.map("map").setView([53.8, -1.6], 6); // UK-ish
    L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
      maxZoom: 19,
      attribution: "&copy; OpenStreetMap contributors"
    }).addTo(map);

    let routeLayer = null;

    function setMessage(text, type = "info") {
      if (!text) {
        messageBox.classList.remove("visible", "error", "info");
        messageText.textContent = "";
        return;
      }
      messageBox.classList.add("visible");
      messageBox.classList.remove("error", "info");
      messageBox.classList.add(type);
      messageText.textContent = text;
    }

    function setRiskLevel(level) {
      riskChip.classList.remove("primary");
      riskChip.classList.remove("low", "medium", "high");
      riskChip.classList.add(level);

      const dot = riskChip.querySelector(".badge-risk-dot");
      riskLabel.textContent =
        level === "high" ? "High risk" : level === "medium" ? "Medium risk" : "Low risk";

      // colour handled via CSS classes; keep primary styling for low
      if (level === "low") riskChip.classList.add("primary");
    }

    function formatKm(km) {
      if (!km && km !== 0) return "â€“";
      if (km < 1) return `${(km * 1000).toFixed(0)} m`;
      return `${km.toFixed(1)} km`;
    }

    function formatMinutes(mins) {
      if (!mins && mins !== 0) return "â€“";
      if (mins < 60) return `${Math.round(mins)} min`;
      const h = Math.floor(mins / 60);
      const m = Math.round(mins % 60);
      return m ? `${h} hr ${m} min` : `${h} hr`;
    }

    function formatBridgeRisk(result) {
      if (!result || !Array.isArray(result.conflicts)) {
        return "No data";
      }
      const count = result.conflicts.length;
      if (count === 0) return "No low-bridge conflicts detected";
      if (count === 1) return "1 low-bridge conflict";
      return `${count} low-bridge conflicts`;
    }

    function formatNearestBridge(nb) {
      if (!nb) return "None on route";
      const h = nb.height_m != null ? `${nb.height_m.toFixed(2)} m` : "unknown height";
      const d =
        nb.distance_m != null
          ? nb.distance_m > 1000
            ? `${(nb.distance_m / 1000).toFixed(1)} km`
            : `${Math.round(nb.distance_m)} m`
          : "unknown distance";
      return `${h} Â· ${d} ahead`;
    }

    function drawRoute(geojson) {
      if (!geojson) return;
      if (routeLayer) {
        map.removeLayer(routeLayer);
      }
      routeLayer = L.geoJSON(geojson, {
        style: {
          weight: 5,
          opacity: 0.9
        }
      }).addTo(map);
      try {
        map.fitBounds(routeLayer.getBounds(), { padding: [20, 20] });
      } catch {
        // ignore fit errors
      }
    }

    async function handleSubmit(event) {
      event.preventDefault();
      setMessage("");

      const start = startInput.value.trim();
      const dest = destInput.value.trim();
      const heightVal = parseFloat(heightInput.value);

      if (!start || !dest || !heightVal || Number.isNaN(heightVal)) {
        setMessage("Please enter start, destination and a valid vehicle height.", "error");
        return;
      }

      submitBtn.disabled = true;
      submitBtn.textContent = "Planning routeâ€¦";

      try {
        const payload = {
          start,
          destination: dest,
          vehicle_height_m: heightVal,
          avoid_low_bridges: !!avoidInput.checked
        };

        const resp = await fetch(API_URL, {
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify(payload)
        });

        if (!resp.ok) {
          const txt = await resp.text();
          throw new Error(`Server responded ${resp.status}: ${txt || resp.statusText}`);
        }

        const data = await resp.json();

        // Expecting shape similar to:
        // { distance_km, duration_min, risk_level, bridge_result, nearest_bridge, route_geojson }
        summaryDistance.textContent = formatKm(data.distance_km);
        summaryTime.textContent = formatMinutes(data.duration_min);
        summaryBridgeRisk.textContent = formatBridgeRisk(data.bridge_result);
        summaryNearest.textContent = formatNearestBridge(data.nearest_bridge);

        setRiskLevel(data.risk_level || "low");

        if (data.route_geojson) {
          drawRoute(data.route_geojson);
        }

        setMessage("Route generated successfully.", "info");
      } catch (err) {
        console.error(err);
        setMessage(
          "Network error: " +
            (err.message && err.message.includes("Failed to fetch")
              ? "Unable to reach RouteSafe engine. Check API URL and server status."
              : err.message),
          "error"
        );
      } finally {
        submitBtn.disabled = false;
        submitBtn.textContent = "Generate Safe Route";
      }
    }

    form.addEventListener("submit", handleSubmit);

    // Pre-fill demo values (your LS27 â†’ M31 pair)
    startInput.value = "LS27 0BN";
    destInput.value = "M31 4QN";
    heightInput.value = "4";
  </script>
</body>
</html>